<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>hepre</title>
</head>

<body>
    <input id="username" type="text" />
    <input id="message" type="text" />
    <button onclick="send()">Send</button>
    <pre id="output"></pre>
    <script>
        var username = document.getElementById("username");
        var message = document.getElementById("message");
        var output = document.getElementById("output");
        var client_send = new WebSocket(`wss://${location.host}/read`);
        var client_recv = new WebSocket(`wss://${location.host}/write`);

        client_recv.onopen = function () {
            output.innerHTML += "Status: Connected\n";
        };

        client_recv.addEventListener('message', function (e) {
            let messages = "";
            for (const comment of JSON.parse(e.data)) {
                messages += `${comment.name}: ${comment.message}\n`;
            }
            output.innerHTML = messages;
        });

        function send() {
            if (message.value === "") return;

            client_send.send(JSON.stringify({
                "name": username.value,
                "message": message.value,
            }));
            message.value = "";
        }
    </script>
</body>

</html>
